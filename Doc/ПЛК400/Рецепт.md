# Рецепт в программе ПЛК400

Рецепты или программы или рабочие данные – параметры, которые необходимы для свинчивания. 

В основном это данные для контроля качества. Т.е. задаются пределы значений, чтобы ПЛК мог их сравнить. 

Например, есть минимальная и максимальная длина муфты. Или минимальнай и максимальная длина преднавёртки. Для рецептов используется блок данных с набором структур. Таких блоков данных в программе встречается много, и все они имеют одинаковую структуру. Почему она не объявлена как UDT – Непонятно. 

Что интересно, в этом блоке есть как уставки (от TCP В ПЛК), так и результаты. И в некоторых блоках используются одни структуры, а в некоторых другие.

Стандартная структура рецепта.

- REZ_ALLG : "REZ_ALLG" – Общие данные
- REZ_Muffe	: "REZ_Muffe" – Данные для муфты
- REZ_MVS	: "REZ_MVS" – Данные для преднавёртки
- REZ_CAM	: "REZ_CAM" – Данные для силовой навертки
- ERG_Muffe	: "ERG_Muffe" – Результат измерения муфты
- ERG_MVS	: "ERG_MVS" – Результат преднавёртки
- ERG_CAM	: "ERG_CAM" – Результат силовой навёртки
- ZEITSTEMPEL : "REZ_ZST" – Метки времени.

Полный перечень этих параметров будет описан отдельно. Их не очень много.

### FB_TPC_REZ

Управление загрузкой рецепта из TPC В ПЛК

Блок вызывается в (1)FB_Komm и использует instance DB в этом блоке. Неявно (т.е. из кода, а не через интерфейс блока) из блок обращается к следующим DB:
- DB700 KOM_REG_SP - Блок обмена коммандами TPC, PLC, EASY, SPS

Управление загрузкой рецепта выполняется при помощи команд. 
Команды – это некоторая переменная типа Dword, В которую записывается номер команды. 
По номеру программы, ПЛК и TPC Выполняют некоторые действия над данными.С помощью команд выполняется согласование действий TPC И ПЛК.

Интерфейс блока:

![-](FB_TPC_REZ.drawio.svg)

__Входы__:
- Frg_Rez – Флаг, разрешающий загрузку нового рецепта. 
  
  Предположительно, разрешение формируется либо если включен ручной режим, либо если автоматический. В обоих режимах проверяется состояние разных процессов работы механизации, таких как смазка, преднавёртка и другие циклы.

__Выходы__:
- TPC_Rez_Neu – Обнаружен новый рецепт. Не используется (нет ссылок)
- TPC_Rez_Akt – Загрузка рецепта завершена. Не используется (нет ссылок)
- 
__Вход/Выход__:
- EASY_Rez_akt – Текущие параметры EASY Доступны. Блок управления загрузкой рецепта сбрасывает этот параметр в FALSE. Если EASY_Rez_akt = false, то блок управления начинает зугркузку параметров в Easy. По окончанию загрузки, взводить его в TRUE.
- TPC_Rez_neu_IO – Новые данные приняты. 

В этом блоке выполняется применение нового рецепта от TPC. TPC Записывает данные в блок 401, а в этом блоке происходит копирование в другие блоки.Так же тут выполняется работа с Easy.
Причем, применение нового рецепта может произойти просто по команде от TPC, если TPC Не соблюла алгоритм передачи.

Алгоритм загрузки нового рецепта из TPC в ПЛК реализованный в этом блоке:

![](Алгоритм%20загрузки%20рецепта.drawio.svg)
