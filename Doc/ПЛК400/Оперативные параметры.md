# Оперативные параметры

Оперативными параметрами назовём такие данные, которые система обрабатывает в процессе каждого свинчивания. 

Процесс свинчивания происходит в несколько этапов:
   
1. Труба с навёрнутой муфтой попадает на позицию
2. Транспорт перемещает трубу вперед на скорости 1 до датчика "Труба перед контр-ключом"
3. Транспорт перемещает трубу вперед на скорости 2 до датчика "Труба перед навёрточной головкой"
4. Труба зажимается в контр-ключе
5. Контр-ключ перемещает трубу вперед на отметку пути W3 на скорости R7
6. Контр-ключ перемещает трубу вперед на отметку пути W4 на скорости R8
7. Контр-ключ отснавливается8. 
8.  Губки тисков сводятся
9.  Когда губки сведены, начинается вращение. Контр-ключе перемещает трубу на скорости R9 (в зависимости от оборотов)
10. В этот момент программа АРМ фиксирует данные с датчиков от EASY
11. Сначала муфта свинчивается на быстрой скорости
12. Затем переходит на пониженную скорость 1
13. Затем переходит на пониженную скорость 2
14. В зависимости от выбранного режима, свинчивание останаилвается при достижении: момента, длины, значения J
15. Соединение оценивается
16. Навёрточная головка открывается
17. Контр-ключ едет назад с трубой на позицию W2 со скорость R7
18. Контр-ключ едет назад с трубой на позицию W1 со скоростью R8
19. Контр-ключ разжимает трубу. Трубу можно снимать



## Алгоритм обмена оперативными параметрами TPC <-> PLC
Для обмена оперативными параметрами, ПЛК и АРМ обмениваются командами в блоке [KOM_REG_SP](DB700%20KOM_REG_SP.md):
1. DB700 : KOM_REG_SP.SPS_CMD_CAM_PLC_SP - команда от ПЛК в АРМ
2. DB700 : KOM_REG_SP.SPS_CMD_CAM_TPC_SP - команда от АРМ в ПЛК

Блок обмена оперативными параметрами называется FB720 : FB_Com_Kraft, и вызывается в блоке FB799 : (1) FB_Komm.

### FB_Com_Kraft имеет следующий вызов:

![](DB720%20FB_Com_Kraft%20Call.drawio.png)

Хотя логика обмена находится внутри блока, ключевую роль этапов обмена определяют следующие переменные, которые передаются в блок как входные параметры, а устанавливаются в блоке FB799 : (1) FB_Komm:

Интерфейс блока:

**Входы:**

1. Send_1 - Собранный сигнал о том, что труба в позиции силовой навертки и готова к перемещению в аппарат
2. Send_2 - Труба достигла пути W6, т.е. готова к свинчиванию
3. Send_3 - Труба достигла пути W6 и готова к развинчиванию (если выбран режим развинчивания)
4. Send_4 - Автомат свинчивания ожидает оценки соединения. Данные о длине свинчивания сохранены (результат оценки от ПЛК при режиме "по длине" или "значению J"). Или завершен процесс развинчивания
5. Send_5 - Когда головка разведена и труба начинает движение назад.
6. EASY_TPC_OK - Вероятно статус коммуникаций, который ПЛК принимает по Profibus от EASY в блоке FB760 : FB_EASY2PLC.
7. VA_Brake - переключатель на пульте ОТВИНТИТЬ
8. VA_ohne_VS - переключатель БЕЗ преднавёртки
9. BA_Wechsel - смена режима работы ?
10. VA_Wechsel - Смена режима движения ? 

**Выходы:**

1. Com_CAM_Akt - коммуникации между ПЛК и АРМ активны. То есть идет регистрация свинчивания на АРМ

![](Алгоритм%20обмена%20оперативными%20параметрами.drawio.svg)

Процесс коммуникаций инициирует PLC.

