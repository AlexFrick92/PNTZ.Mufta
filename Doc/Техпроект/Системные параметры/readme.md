# Системные параметры

Кроме основных данных, между АРМ и ПЛК передаются вспомогательные параметры.

Системные параметр находятся в DB400. АРМ и ПЛК могут читать и записывать эти параметры. В этом блоке есть команды для обмена другими данными.

Параметры, которые относятся к системным DB400 : KOM_REG
```
CAM_Watchdog        DWORD       Бит жизни. Устанавливается в 1 АРМ. ПЛК сбрасывает. 
CAM_LOG_NO          DWORD       АРМ в рецепте указывает значение, а ПЛК делает инкремент
CAM_CON_NO          DWORD       АРМ в рецепте указывает значение, а ПЛК делает инкремент
CAM_OPERATE_MODE    DWORD       Режим ПЛК. 1 - ручной, 2 - авто
CAM_TPC_READY       DWORD       Готовность АРМ к работе
```

**CAM_Watchdog**

В ПЛК и программе АРМ реализован простой алгоритм.

АРМ устанавливает этот регистр в 1.
ПЛК сбрасывает этот регистр в 0. 

Таким образом, если в регистре находится значение 0 то запускается отсчет. По истечении 5 секунд ПЛК фиксирует ошибку связи с АРМ. Если АРМ установит этот регистр в 1, то таймер останавливается.

На стороне АРМ ситуация обратная, если регистр находится в 1 дольше заданного времени, то программа ПЛК не работает.

Так как мы ставим ПЛК1517, то ПЛК1517 должен повторить алгоритм АРМ для ПЛК400. То есть устанавливать CAM_Watchdog в 1.

Контроль связи ПЛК1517 и программы АРМ сделаем следующим образом:

Создадим блок данных **TPC**, в котором будут следующие регистры:
```
TPC_Heartbeat       bool        регистр бита жизни. Прямоугольный сигнал с периодом 2 секунды. 
                                Записиь от АРМ. Если АРМ не передает этот бит, 
                                то не устанавливаем CAM_Watchdog для ПЛК400.

PLC_Heartbeat       bool        регистр бита жизни. Прямоугольный сигнал с периодом 2 секунды. 
                                Записиь от ПЛК. Если ПЛК400 CAM_Watchdog не сбрасывает, 
                                то остановим heartbeat.
```

![](Схема%20CAM_Watchdog.drawio.svg)

**CAM_LOG_NO**, **CAM_CON_NO**.

Этот параметр мы запишем один раз в ПЛК400, при загрузке рецепта. Момент передачи этих данных нужно сделать тогда, когда АРМ передаст команду TPC_CMD = 20.

После этого значение будет только считыватся от ПЛК400 и передаваться в АРМ.

![](Схема%20CAM_LOGNO.drawio.svg)

**CAM_OPERATE_MODE**

Этот параметр считываем из ПЛК400. Это режим работы установки

**CAM_TPC_READY**

Этот параметр записываем в ПЛК400. Это готовность АРМ к работе.
