<UserControl x:Class="PNTZ.Mufta.TPCApp.View.Control.ChartView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:PNTZ.Mufta.TPCApp.View"
             xmlns:fmtr="clr-namespace:PNTZ.Mufta.TPCApp.View.Formatter"
             xmlns:converter="clr-namespace:PNTZ.Mufta.TPCApp.View.Converter"
             xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/charts"
             xmlns:dxcore="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:vmControl="clr-namespace:PNTZ.Mufta.TPCApp.ViewModel.Control"
             d:DataContext="{d:DesignInstance Type=vmControl:ChartViewModel}"
             mc:Ignorable="d"
             d:DesignHeight="450"
             d:DesignWidth="800">

    <!-- ========================================
         РЕСУРСЫ
         ======================================== -->
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Styles/AppStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- ========================================
                 КОНВЕРТЕРЫ
                 ======================================== -->
            <converter:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>

            <!-- ========================================
                 СТИЛИ
                 ======================================== -->

            <!-- Стиль для заголовка графика -->
            <Style TargetType="Label" x:Key="ChartHeader">
                <Setter Property="Grid.Row" Value="0"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Margin" Value="0,10,0,-5"/>
            </Style>

            <!-- Стиль для ChartControl -->
            <Style TargetType="dxc:ChartControl" x:Key="ChartStyle">
                <Setter Property="BorderThickness" Value="0"/>
            </Style>

            <!-- Стиль для панели графика -->
            <Style TargetType="dxc:Pane" x:Key="PaneStyle">
                <Setter Property="DomainBrush" Value="Transparent"/>
            </Style>

            <!-- Стиль для оси X -->
            <Style TargetType="dxc:AxisX2D" x:Key="AxisXStyle">
                <Setter Property="GridLinesVisible" Value="True"/>
                <Setter Property="GridLinesBrush" Value="#F0F0F0"/>
            </Style>

            <!-- Стиль для оси Y -->
            <Style TargetType="dxc:AxisY2D" x:Key="AxisYStyle">
                <Setter Property="GridLinesVisible" Value="True"/>
                <Setter Property="GridLinesBrush" Value="#F0F0F0"/>
                <Setter Property="Interlaced" Value="False"/>
            </Style>

            <!-- ========================================
                 ШАБЛОНЫ ДАННЫХ
                 ======================================== -->

            <!-- Шаблон для постоянных линий (DataContext: ConstantLineViewModel) -->
            <DataTemplate x:Key="ConstantLineTemplate">
                <dxc:ConstantLine Value="{Binding Value}" Brush="{Binding LineColor}">
                    <dxc:ConstantLine.LineStyle>
                        <dxc:LineStyle Thickness="1"/>
                    </dxc:ConstantLine.LineStyle>
                    <dxc:ConstantLine.Title>
                        <dxc:ConstantLineTitle>
                            <StackPanel Orientation="Horizontal">
                                <!-- Метка линии -->
                                <Label Foreground="{Binding LabelColor}"
                                       FontSize="12"
                                       Content="{Binding Label}"
                                       Margin="0,0,4,0"/>

                                <!-- Значение линии -->
                                <TextBlock Foreground="{Binding LabelColor}"
                                           Text="{Binding FormattedValue}"
                                           FontSize="12"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </dxc:ConstantLineTitle>
                    </dxc:ConstantLine.Title>
                </dxc:ConstantLine>
            </DataTemplate>

            <DataTemplate x:Key="StripDataTemplate">
                <dxc:Strip  
                    MinLimit="{Binding MinValue}"
                    MaxLimit="{Binding MaxValue}"
                    Brush="{Binding Color}"
                    BorderColor="Transparent"
                    />

            </DataTemplate>


            <!-- Шаблон для серий данных (DataContext: ChartSeriesViewModel) -->
            <DataTemplate x:Key="ChartSeriesTemplate">
                <dxc:AreaSeries2D DataSource="{Binding DataContext.ChartData, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  ArgumentDataMember="{Binding DataContext.ArgumentMember, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                  ValueDataMember="{Binding ValueMember}"
                                  ArgumentScaleType="Numerical"
                                  CrosshairEnabled="True"
                                  Transparency="1"
                                  DisplayName="{Binding DisplayName}">

                    <!-- Граница серии (линия графика) -->
                    <dxc:AreaSeries2D.Border>
                        <dxc:SeriesBorder Brush="{Binding LineColor}">
                            <dxc:SeriesBorder.LineStyle>
                                <dxc:LineStyle Thickness="{Binding LineThickness}"/>
                            </dxc:SeriesBorder.LineStyle>
                        </dxc:SeriesBorder>
                    </dxc:AreaSeries2D.Border>

                </dxc:AreaSeries2D>
            </DataTemplate>

        </ResourceDictionary>
    </UserControl.Resources>

    <!-- ========================================
         ОСНОВНАЯ РАЗМЕТКА
         ======================================== -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Заголовок графика -->
        <Label Grid.Row="0"
               Style="{StaticResource ChartHeader}"
               Content="{Binding ChartTitle}"
               Visibility="{Binding ChartTitle, Converter={StaticResource NullToVisibilityConverter}}"/>

        <!-- ========================================
             ГРАФИК (DevExpress ChartControl)
             ======================================== -->
        <dxc:ChartControl Grid.Row="1"
                          Style="{StaticResource ChartStyle}"
                          CrosshairEnabled="True"
                          dxcore:ThemeManager.ThemeName="MetropolisLight"
                          >

            <!-- Настройки перекрестия -->
            <dxc:ChartControl.CrosshairOptions>
                <dxc:CrosshairOptions ShowCrosshairLabels="False"
                                      ShowValueLabels="True"
                                      ShowValueLine="True"
                                      ShowArgumentLabels="True"
                                      HighlightPoints="False"
                                      ShowArgumentLine="True"/>
            </dxc:ChartControl.CrosshairOptions>

            <!-- ========================================
                 ДИАГРАММА XY
                 ======================================== -->
            <dxc:ChartControl.Diagram>
                <dxc:XYDiagram2D x:Name="diagram"
                                 EnableAxisXNavigation="True"
                                 EnableAxisYNavigation="True"
                                 SeriesItemsSource="{Binding Series}"
                                 SeriesItemTemplate="{StaticResource ChartSeriesTemplate}">


                    <!-- Настройки навигации -->
                    <dxc:XYDiagram2D.NavigationOptions>
                        <dxc:NavigationOptions UseKeyboard="False"
                                               UseScrollBars="True"
                                               UseMouse="True"
                                               UseTouchDevice="False"/>
                    </dxc:XYDiagram2D.NavigationOptions>

                    <!-- ========================================
                         ПАНЕЛЬ ГРАФИКА
                         ======================================== -->
                    <dxc:XYDiagram2D.DefaultPane>
                        <dxc:Pane Style="{StaticResource PaneStyle}">

                            <!-- Скроллбар оси X -->
                            <dxc:Pane.AxisXScrollBarOptions>
                                <dxc:ScrollBarOptions Visible="False"
                                                      BarThickness="10"
                                                      AnnotatedElements="None"
                                                      Alignment="Far"/>
                            </dxc:Pane.AxisXScrollBarOptions>

                            <!-- Скроллбар оси Y -->
                            <dxc:Pane.AxisYScrollBarOptions>
                                <dxc:ScrollBarOptions Visible="False"
                                                      BarThickness="10"
                                                      AnnotatedElements="None"
                                                      Alignment="Far"/>
                            </dxc:Pane.AxisYScrollBarOptions>

                        </dxc:Pane>
                    </dxc:XYDiagram2D.DefaultPane>

                    <!-- ========================================
                         ОСЬ X
                         ======================================== -->
                    <dxc:XYDiagram2D.AxisX>
                        <dxc:AxisX2D Style="{StaticResource AxisXStyle}" Alignment="Zero"> 

                            <!-- Заголовок оси X -->
                            <dxc:AxisX2D.Title>
                                <dxc:AxisTitle Content="{Binding XAxisTitle}"
                                               Foreground="Black"
                                               Visibility="{Binding XAxisTitle, Converter={StaticResource NullToVisibilityConverter}}"/>
                            </dxc:AxisX2D.Title>

                            <!-- Полный диапазон оси X -->
                            <dxc:AxisX2D.WholeRange>
                                <dxc:Range MinValue="{Binding XMin}"
                                           MaxValue="{Binding XMax}"
                                           SideMarginsValue="0"/>
                            </dxc:AxisX2D.WholeRange>

                            <!-- Видимый диапазон оси X -->
                            <dxc:AxisX2D.VisualRange>
                                <dxc:Range MinValue="{Binding XMin}"
                                           MaxValue="{Binding XMax}"
                                           SideMarginsValue="0"/>
                            </dxc:AxisX2D.VisualRange>

                            <!-- Формат меток перекрестия -->
                            <dxc:AxisX2D.CrosshairAxisLabelOptions>
                                <dxc:CrosshairAxisLabelOptions Pattern="{}{V:.#}"/>
                            </dxc:AxisX2D.CrosshairAxisLabelOptions>

                            <!-- Формат меток оси -->
                            <dxc:AxisX2D.Label>
                                <dxc:AxisLabel Formatter="{Binding XAxisLabelFormatter}"/>
                            </dxc:AxisX2D.Label>

                            <!-- Постоянные линии (за элементами графика) -->
                            <dxc:AxisX2D.ConstantLineBehindItemsSource>
                                <Binding Path="XConstantLines"/>
                            </dxc:AxisX2D.ConstantLineBehindItemsSource>

                            <dxc:AxisX2D.ConstantLineBehindItemTemplate>
                                <StaticResource ResourceKey="ConstantLineTemplate"/>
                            </dxc:AxisX2D.ConstantLineBehindItemTemplate>

                            
                            <!--Выделенные области-->
                            <dxc:AxisX2D.StripItemsSource>
                                <Binding Path="XStrips"/>
                            </dxc:AxisX2D.StripItemsSource>
                            
                            <dxc:AxisX2D.StripItemTemplate>
                                <StaticResource ResourceKey="StripDataTemplate"/>
                            </dxc:AxisX2D.StripItemTemplate>


                        </dxc:AxisX2D>
                    </dxc:XYDiagram2D.AxisX>

                    <!-- ========================================
                         ОСЬ Y
                         ======================================== -->
                    <dxc:XYDiagram2D.AxisY>
                        <dxc:AxisY2D Style="{StaticResource AxisYStyle}" Alignment="Zero">

                            <!-- Заголовок оси Y -->
                            <dxc:AxisY2D.Title>
                                <dxc:AxisTitle Content="{Binding YAxisTitle}"
                                               Foreground="Black"
                                               Visibility="{Binding YAxisTitle, Converter={StaticResource NullToVisibilityConverter}}"/>
                            </dxc:AxisY2D.Title>

                            <!-- Полный диапазон оси Y -->
                            <dxc:AxisY2D.WholeRange>
                                <dxc:Range MinValue="{Binding YMin}"
                                           MaxValue="{Binding YMax}"
                                           SideMarginsValue="0"/>
                            </dxc:AxisY2D.WholeRange>

                            <!-- Видимый диапазон оси Y -->
                            <dxc:AxisY2D.VisualRange>
                                <dxc:Range MinValue="{Binding YMin}"
                                           MaxValue="{Binding YMax}"
                                           SideMarginsValue="0"/>
                            </dxc:AxisY2D.VisualRange>

                            <!-- Формат меток перекрестия -->
                            <dxc:AxisY2D.CrosshairAxisLabelOptions>
                                <dxc:CrosshairAxisLabelOptions Pattern="{}{V:.#}"/>
                            </dxc:AxisY2D.CrosshairAxisLabelOptions>

                            <!-- Формат меток оси -->
                            <dxc:AxisY2D.Label>
                                <dxc:AxisLabel Formatter="{Binding YAxisLabelFormatter}"/>
                            </dxc:AxisY2D.Label>

                            <!-- Постоянные линии (за элементами графика) -->
                            <dxc:AxisY2D.ConstantLineBehindItemTemplate>
                                <StaticResource ResourceKey="ConstantLineTemplate"/>
                            </dxc:AxisY2D.ConstantLineBehindItemTemplate>

                            <!-- Постоянные линии (перед элементами графика) -->
                            <dxc:AxisY2D.ConstantLineInFrontItemsSource>
                                <Binding Path="YConstantLines"/>
                            </dxc:AxisY2D.ConstantLineInFrontItemsSource>

                            <dxc:AxisY2D.ConstantLineInFrontItemTemplate>
                                <StaticResource ResourceKey="ConstantLineTemplate"/>
                            </dxc:AxisY2D.ConstantLineInFrontItemTemplate>

                            <!--Выделенные области-->
                            <dxc:AxisY2D.StripItemsSource>
                                <Binding Path="YStrips"/>
                            </dxc:AxisY2D.StripItemsSource>

                            <dxc:AxisY2D.StripItemTemplate>
                                <StaticResource ResourceKey="StripDataTemplate"/>
                            </dxc:AxisY2D.StripItemTemplate>

                        </dxc:AxisY2D>
                    </dxc:XYDiagram2D.AxisY>

                    <dxc:XYDiagram2D.Series>
                            
                    </dxc:XYDiagram2D.Series>


                </dxc:XYDiagram2D>
            </dxc:ChartControl.Diagram>

        </dxc:ChartControl>

    </Grid>
</UserControl>
