<UserControl x:Class="PNTZ.Mufta.TPCApp.View.Control.ChartView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             
             xmlns:local="clr-namespace:PNTZ.Mufta.TPCApp.View"
             xmlns:fmtr="clr-namespace:PNTZ.Mufta.TPCApp.View.Formatter"

             xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/charts"
             xmlns:dxcore="http://schemas.devexpress.com/winfx/2008/xaml/core"
             
             xmlns:vmControl="clr-namespace:PNTZ.Mufta.TPCApp.ViewModel.Control"
             
             d:DataContext="{d:DesignInstance Type=vmControl:ChartViewModel}"
             
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Styles/AppStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- Конвертер для форматирования значений -->
            <fmtr:DefaultDoubleLabelFormatter x:Key="DoubleFormatConverter"/>

            <Style TargetType="Label" x:Key="ChartHeader">
                <Setter Property="Grid.Row" Value="0"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Margin" Value="0,10,0,-5"/>
            </Style>

            <Style TargetType="dxc:ChartControl" x:Key="ChartStyle">
                <Setter Property="BorderThickness" Value="0"/>
            </Style>

            <Style TargetType="dxc:Pane" x:Key="PaneStyle">
                <Setter Property="DomainBrush" Value="Transparent"/>
            </Style>

            <Style TargetType="dxc:AxisX2D" x:Key="AxisXStyle">
                <Setter Property="GridLinesVisible" Value="True"/>
                <Setter Property="GridLinesBrush" Value="#F0F0F0"/>
            </Style>

            <Style TargetType="dxc:AxisY2D" x:Key="AxisYStyle">
                <Setter Property="GridLinesVisible" Value="True"/>
                <Setter Property="GridLinesBrush" Value="#F0F0F0"/>
                <Setter Property="Interlaced" Value="False"/>
            </Style>

           <!-- Шаблон данных для постоянных линий (DataContext: ConstantLineViewModel) -->
            <DataTemplate x:Key="ConstantLineTemplate">
                <dxc:ConstantLine
                      Value="{Binding Value}"
                      Brush="{Binding Color}">
                    <dxc:ConstantLine.Title>
                        <dxc:ConstantLineTitle>
                            <StackPanel Orientation="Horizontal">
                                <Label Foreground="{Binding Color}"
                                       FontSize="12"
                                       Content="{Binding Label}"
                                       Margin="0,0,4,0"/>
                                <TextBlock Foreground="{Binding Color}"
                                           Text="{Binding Value}"
                                           FontSize="12"
                                           VerticalAlignment="Center">
                                    <!--<TextBlock.Text>
                                        <MultiBinding Converter="{StaticResource DoubleFormatConverter}">
                                            <Binding Path="Value"/>
                                            <Binding Path="ValueFormat"/>
                                        </MultiBinding>
                                    </TextBlock.Text>-->
                                </TextBlock>
                            </StackPanel>
                        </dxc:ConstantLineTitle>
                    </dxc:ConstantLine.Title>
                </dxc:ConstantLine>
            </DataTemplate>


        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition/>
        </Grid.RowDefinitions>

        <Label
           Style="{StaticResource ChartHeader}"
           Content="{Binding ChartTitle}" />

        <dxc:ChartControl Grid.Row="1" Style="{StaticResource ChartStyle}"
                     CrosshairEnabled="True"    
                     dxcore:ThemeManager.ThemeName="MetropolisLight">
            
            <dxc:ChartControl.CrosshairOptions>
                <dxc:CrosshairOptions ShowCrosshairLabels="False"
                         ShowValueLabels="True" 
                         ShowValueLine="True" 
                         ShowArgumentLabels="True" 
                         HighlightPoints="False"                              
                         ShowArgumentLine="True"/>
                
            </dxc:ChartControl.CrosshairOptions>

            <dxc:ChartControl.Diagram>
                <dxc:XYDiagram2D EnableAxisXNavigation="True"
                           EnableAxisYNavigation="True"
                           x:Name="diagram">
                    <dxc:XYDiagram2D.NavigationOptions>
                        <dxc:NavigationOptions 
                       UseKeyboard="False"
                       UseScrollBars="True"
                       UseMouse="True"
                       UseTouchDevice="False"                                                        
                       />
                    </dxc:XYDiagram2D.NavigationOptions>

                    <dxc:XYDiagram2D.DefaultPane>
                        <dxc:Pane Style="{StaticResource PaneStyle}">
                            <dxc:Pane.AxisXScrollBarOptions>
                                <dxc:ScrollBarOptions Visible="False"
                                                 BarThickness="10"                                                      
                                                 AnnotatedElements="None"
                                                 Alignment="Far"
                                                 />
                            </dxc:Pane.AxisXScrollBarOptions>
                            <dxc:Pane.AxisYScrollBarOptions>
                                <dxc:ScrollBarOptions Alignment="Far" 
                                 BarThickness="10"
                                 AnnotatedElements="None"                                                        
                                 Visible="False">

                                </dxc:ScrollBarOptions>
                            </dxc:Pane.AxisYScrollBarOptions>
                        </dxc:Pane>
                    </dxc:XYDiagram2D.DefaultPane>

                    <dxc:XYDiagram2D.AxisX>
                        <dxc:AxisX2D Style="{StaticResource AxisXStyle}">

                            <dxc:AxisX2D.WholeRange>
                                <dxc:Range
                                   MinValue="{Binding XMin}"
                                   MaxValue="{Binding XMax}"
                                   SideMarginsValue="0"/>
                            </dxc:AxisX2D.WholeRange>

                            <dxc:AxisX2D.VisualRange>
                                <dxc:Range
                                   MinValue="{Binding XMin}"
                                   MaxValue="{Binding XMax}"
                                   SideMarginsValue="0"/>
                            </dxc:AxisX2D.VisualRange>

                            <dxc:AxisX2D.CrosshairAxisLabelOptions>
                                <dxc:CrosshairAxisLabelOptions Pattern="{}{V:.#}" />
                            </dxc:AxisX2D.CrosshairAxisLabelOptions>

                            <dxc:AxisX2D.Label>
                                <dxc:AxisLabel>
                                    <dxc:AxisLabel.Formatter>
                                        <fmtr:DefaultDoubleLabelFormatter/>
                                    </dxc:AxisLabel.Formatter>
                                </dxc:AxisLabel>
                            </dxc:AxisX2D.Label>

                            <dxc:AxisX2D.ConstantLineBehindItemsSource>
                                <Binding Path="XConstantLines" />
                            </dxc:AxisX2D.ConstantLineBehindItemsSource>

                            <dxc:AxisX2D.ConstantLineBehindItemTemplate>
                                <StaticResource ResourceKey="ConstantLineTemplate"/>
                            </dxc:AxisX2D.ConstantLineBehindItemTemplate>

                        </dxc:AxisX2D>

                    </dxc:XYDiagram2D.AxisX>

                    <dxc:XYDiagram2D.AxisY>
                        <dxc:AxisY2D Style="{StaticResource AxisYStyle}">

                            <dxc:AxisY2D.WholeRange>
                                <dxc:Range
                                   MinValue="{Binding YMin}"
                                   MaxValue="{Binding YMax}"
                                   SideMarginsValue="0"/>
                            </dxc:AxisY2D.WholeRange>

                            <dxc:AxisY2D.VisualRange>
                                <dxc:Range
                                   MinValue="{Binding YMin}"
                                   MaxValue="{Binding YMax}"
                                   SideMarginsValue="0"/>
                            </dxc:AxisY2D.VisualRange>
                          
                            <dxc:AxisY2D.CrosshairAxisLabelOptions>
                                <dxc:CrosshairAxisLabelOptions Pattern="{}{V:.#}" />
                            </dxc:AxisY2D.CrosshairAxisLabelOptions>


                            <dxc:AxisY2D.Label>
                                <dxc:AxisLabel>
                                    <dxc:AxisLabel.Formatter>
                                        <fmtr:DefaultDoubleLabelFormatter/>
                                    </dxc:AxisLabel.Formatter>
                                </dxc:AxisLabel>
                            </dxc:AxisY2D.Label>

                            <dxc:AxisY2D.ConstantLineBehindItemTemplate >
                                <StaticResource ResourceKey="ConstantLineTemplate"/>
                            </dxc:AxisY2D.ConstantLineBehindItemTemplate >

                            <dxc:AxisY2D.ConstantLineInFrontItemsSource>
                                <Binding Path="YConstantLines" />
                            </dxc:AxisY2D.ConstantLineInFrontItemsSource>

                            <dxc:AxisY2D.ConstantLineInFrontItemTemplate>
                                <StaticResource ResourceKey="ConstantLineTemplate"/>
                            </dxc:AxisY2D.ConstantLineInFrontItemTemplate>

                        </dxc:AxisY2D>
                    </dxc:XYDiagram2D.AxisY>

                    <dxc:AreaSeries2D
                       DataSource="{Binding ChartData}"
                       ArgumentDataMember="{Binding ArgumentMember}"
                       ValueDataMember="{Binding ValueMember}"
                       ArgumentScaleType="Numerical"
                       CrosshairEnabled="True"
                       Transparency="1">

                        <dxc:AreaSeries2D.Border>
                            <dxc:SeriesBorder Brush="{Binding LineColor}">
                                <dxc:SeriesBorder.LineStyle>
                                    <dxc:LineStyle Thickness="{Binding LineThickness}"/>
                                </dxc:SeriesBorder.LineStyle>
                            </dxc:SeriesBorder>
                        </dxc:AreaSeries2D.Border>
                    </dxc:AreaSeries2D>

                </dxc:XYDiagram2D>
            </dxc:ChartControl.Diagram>
        </dxc:ChartControl>
    </Grid>
</UserControl>
